!function(e,t,n,r){function c(e,t){var n=Math.max(0,e[0]-t[0],t[0]-e[1]),r=Math.max(0,e[2]-t[1],t[1]-e[3]);return n+r}function h(t,n,r,i){var s=t.length,o=i?"offset":"position";r=r||0;while(s--){var u=t[s].el?t[s].el:e(t[s]),a=u[o]();a.left+=parseInt(u.css("margin-left"),10);a.top+=parseInt(u.css("margin-top"),10);n[s]=[a.left-r,a.left+u.outerWidth()+r,a.top-r,a.top+u.outerHeight()+r]}}function p(e,t){var n=t.offset();return{left:e.left-n.left,top:e.top-n.top}}function d(e,t,n){t=[t.left,t.top];n=n&&[n.left,n.top];var r,i=e.length,s=[];while(i--){r=e[i];s[i]=[i,c(r,t),n&&c(r,n)]}s=s.sort(function(e,t){return t[1]-e[1]||t[2]-e[2]||t[0]-e[0]});return s}function v(t){this.options=e.extend({},o,t);this.containers=[];if(!this.options.rootGroup){this.scrollProxy=e.proxy(this.scroll,this);this.dragProxy=e.proxy(this.drag,this);this.dropProxy=e.proxy(this.drop,this);this.placeholder=e(this.options.placeholder);if(!t.isValidTarget)this.options.isValidTarget=r}}function m(t,n){this.el=t;this.options=e.extend({},s,n);this.group=v.get(this.options);this.rootGroup=this.options.rootGroup||this.group;this.handle=this.rootGroup.options.handle||this.rootGroup.options.itemSelector;var r=this.rootGroup.options.itemPath;this.target=r?this.el.find(r):this.el;this.target.on(i.start,this.handle,e.proxy(this.dragInit,this));if(this.options.drop)this.group.containers.push(this)}var i,s={drag:true,drop:true,exclude:"",nested:true,vertical:true},o={afterMove:function(e,t,n){},containerPath:"",containerSelector:"ol, ul",distance:0,delay:0,handle:"",itemPath:"",itemSelector:"li",isValidTarget:function(e,t){return true},onCancel:function(e,t,n,r){},onDrag:function(e,t,n,r){e.css(t)},onDragStart:function(t,n,r,i){t.css({height:t.height(),width:t.width()});t.addClass("dragged");e("body").addClass("dragging")},onDrop:function(t,n,r,i){t.removeClass("dragged").removeAttr("style");e("body").removeClass("dragging")},onMousedown:function(e,t,n){if(!n.target.nodeName.match(/^(input|select)$/i)){n.preventDefault();return true}},placeholder:'<li class="placeholder"/>',pullPlaceholder:true,serialize:function(t,n,r){var i=e.extend({},t.data());if(r)return[n];else if(n[0]){i.children=n}delete i.subContainers;delete i.sortable;return i},tolerance:0},u={},a=0,f={left:0,top:0,bottom:0,right:0},i={start:"touchstart.sortable mousedown.sortable",drop:"touchend.sortable touchcancel.sortable mouseup.sortable",drag:"touchmove.sortable mousemove.sortable",scroll:"scroll.sortable"},l="subContainers";v.get=function(e){if(!u[e.group]){if(e.group===r)e.group=a++;u[e.group]=new v(e)}return u[e.group]};v.prototype={dragInit:function(t,n){this.$document=e(n.el[0].ownerDocument);this.item=e(t.target).closest(this.options.itemSelector);this.itemContainer=n;if(this.item.is(this.options.exclude)||!this.options.onMousedown(this.item,o.onMousedown,t)){return}this.setPointer(t);this.toggleListeners("on");this.setupDelayTimer();this.dragInitDone=true},drag:function(e){if(!this.dragging){if(!this.distanceMet(e)||!this.delayMet)return;this.options.onDragStart(this.item,this.itemContainer,o.onDragStart,e);this.item.before(this.placeholder);this.dragging=true}this.setPointer(e);this.options.onDrag(this.item,p(this.pointer,this.item.offsetParent()),o.onDrag,e);var t=e.pageX||e.originalEvent.pageX,n=e.pageY||e.originalEvent.pageY,r=this.sameResultBox,i=this.options.tolerance;if(!r||r.top-i>n||r.bottom+i<n||r.left-i>t||r.right+i<t)if(!this.searchValidTarget())this.placeholder.detach()},drop:function(e){this.toggleListeners("off");this.dragInitDone=false;if(this.dragging){if(this.placeholder.closest("html")[0])this.placeholder.before(this.item).detach();else this.options.onCancel(this.item,this.itemContainer,o.onCancel,e);this.options.onDrop(this.item,this.getContainer(this.item),o.onDrop,e);this.clearDimensions();this.clearOffsetParent();this.lastAppendedItem=this.sameResultBox=r;this.dragging=false}},searchValidTarget:function(e,t){if(!e){e=this.relativePointer||this.pointer;t=this.lastRelativePointer||this.lastPointer}var n=d(this.getContainerDimensions(),e,t),i=n.length;while(i--){var s=n[i][0],o=n[i][1];if(!o||this.options.pullPlaceholder){var u=this.containers[s];if(!u.disabled){if(!this.$getOffsetParent()){var a=u.getItemOffsetParent();e=p(e,a);t=p(t,a)}if(u.searchValidTarget(e,t))return true}}}if(this.sameResultBox)this.sameResultBox=r},movePlaceholder:function(e,t,n,r){var i=this.lastAppendedItem;if(!r&&i&&i[0]===t[0])return;t[n](this.placeholder);this.lastAppendedItem=t;this.sameResultBox=r;this.options.afterMove(this.placeholder,e,t)},getContainerDimensions:function(){if(!this.containerDimensions)h(this.containers,this.containerDimensions=[],this.options.tolerance,!this.$getOffsetParent());return this.containerDimensions},getContainer:function(e){return e.closest(this.options.containerSelector).data(n)},$getOffsetParent:function(){if(this.offsetParent===r){var e=this.containers.length-1,t=this.containers[e].getItemOffsetParent();if(!this.options.rootGroup){while(e--){if(t[0]!=this.containers[e].getItemOffsetParent()[0]){t=false;break}}}this.offsetParent=t}return this.offsetParent},setPointer:function(e){var t=this.getPointer(e);if(this.$getOffsetParent()){var n=p(t,this.$getOffsetParent());this.lastRelativePointer=this.relativePointer;this.relativePointer=n}this.lastPointer=this.pointer;this.pointer=t},distanceMet:function(e){var t=this.getPointer(e);return Math.max(Math.abs(this.pointer.left-t.left),Math.abs(this.pointer.top-t.top))>=this.options.distance},getPointer:function(e){return{left:e.pageX||e.originalEvent.pageX,top:e.pageY||e.originalEvent.pageY}},setupDelayTimer:function(){var e=this;this.delayMet=!this.options.delay;if(!this.delayMet){clearTimeout(this._mouseDelayTimer);this._mouseDelayTimer=setTimeout(function(){e.delayMet=true},this.options.delay)}},scroll:function(e){this.clearDimensions();this.clearOffsetParent()},toggleListeners:function(t){var n=this,r=["drag","drop","scroll"];e.each(r,function(e,r){n.$document[t](i[r],n[r+"Proxy"])})},clearOffsetParent:function(){this.offsetParent=r},clearDimensions:function(){this.traverse(function(e){e._clearDimensions()})},traverse:function(e){e(this);var t=this.containers.length;while(t--){this.containers[t].traverse(e)}},_clearDimensions:function(){this.containerDimensions=r},_destroy:function(){u[this.options.group]=r}};m.prototype={dragInit:function(e){var t=this.rootGroup;if(!this.disabled&&!t.dragInitDone&&this.options.drag&&this.isValidDrag(e)){t.dragInit(e,this)}},isValidDrag:function(e){return e.which==1||e.type=="touchstart"&&e.originalEvent.touches.length==1},searchValidTarget:function(e,t){var n=d(this.getItemDimensions(),e,t),r=n.length,i=this.rootGroup,s=!i.options.isValidTarget||i.options.isValidTarget(i.item,this);if(!r&&s){i.movePlaceholder(this,this.target,"append");return true}else while(r--){var o=n[r][0],u=n[r][1];if(!u&&this.hasChildGroup(o)){var a=this.getContainerGroup(o).searchValidTarget(e,t);if(a)return true}else if(s){this.movePlaceholder(o,e);return true}}},movePlaceholder:function(t,n){var r=e(this.items[t]),i=this.itemDimensions[t],s="after",o=r.outerWidth(),u=r.outerHeight(),a=r.offset(),l={left:a.left,right:a.left+o,top:a.top,bottom:a.top+u};if(this.options.vertical){var c=(i[2]+i[3])/2,h=n.top<=c;if(h){s="before";l.bottom-=u/2}else l.top+=u/2}else{var p=(i[0]+i[1])/2,d=n.left<=p;if(d){s="before";l.right-=o/2}else l.left+=o/2}if(this.hasChildGroup(t))l=f;this.rootGroup.movePlaceholder(this,r,s,l)},getItemDimensions:function(){if(!this.itemDimensions){this.items=this.$getChildren(this.el,"item").filter(":not(.placeholder, .dragged)").get();h(this.items,this.itemDimensions=[],this.options.tolerance)}return this.itemDimensions},getItemOffsetParent:function(){var e,t=this.el;if(t.css("position")==="relative"||t.css("position")==="absolute"||t.css("position")==="fixed")e=t;else e=t.offsetParent();return e},hasChildGroup:function(e){return this.options.nested&&this.getContainerGroup(e)},getContainerGroup:function(t){var i=e.data(this.items[t],l);if(i===r){var s=this.$getChildren(this.items[t],"container");i=false;if(s[0]){var o=e.extend({},this.options,{rootGroup:this.rootGroup,group:a++});i=s[n](o).data(n).group}e.data(this.items[t],l,i)}return i},$getChildren:function(t,n){var r=this.rootGroup.options,i=r[n+"Path"],s=r[n+"Selector"];t=e(t);if(i)t=t.find(i);return t.children(s)},_serialize:function(t,n){var r=this,i=n?"item":"container",s=this.$getChildren(t,i).not(this.options.exclude).map(function(){return r._serialize(e(this),!n)}).get();return this.rootGroup.options.serialize(t,s,n)},traverse:function(t){e.each(this.items||[],function(n){var r=e.data(this,l);if(r)r.traverse(t)});t(this)},_clearDimensions:function(){this.itemDimensions=r},_destroy:function(){var t=this;this.target.off(i.start,this.handle);this.el.removeData(n);if(this.options.drop)this.group.containers=e.grep(this.group.containers,function(e){return e!=t});e.each(this.items||[],function(){e.removeData(this,l)})}};var g={enable:function(){this.traverse(function(e){e.disabled=false})},disable:function(){this.traverse(function(e){e.disabled=true})},serialize:function(){return this._serialize(this.el,true)},refresh:function(){this.traverse(function(e){e._clearDimensions()})},destroy:function(){this.traverse(function(e){e._destroy()})}};e.extend(m.prototype,g);e.fn[n]=function(t){var i=Array.prototype.slice.call(arguments,1);return this.map(function(){var s=e(this),o=s.data(n);if(o&&g[t])return g[t].apply(o,i)||this;else if(!o&&(t===r||typeof t==="object"))s.data(n,new m(s,t));return this})}}(jQuery,window,"sortable")
